<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Logging using ParallelLogger • ParallelLogger</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Logging using ParallelLogger">
<meta property="og:description" content="ParallelLogger">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ParallelLogger</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Logging.html">Logging using ParallelLogger</a>
    </li>
    <li>
      <a href="../articles/Parallel.html">Parallel execution using ParallelLogger</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/ParallelLogger/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Logging using ParallelLogger</h1>
                        <h4 class="author">Martijn J. Schuemie</h4>
            
            <h4 class="date">2020-06-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/ParallelLogger/blob/master/vignettes/Logging.Rmd"><code>vignettes/Logging.Rmd</code></a></small>
      <div class="hidden name"><code>Logging.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This vignette describes how you can use the <code>ParallelLogger</code> package to perform logging. Logging is the activity of recording events that occur during an analysis in a log. The log can be used for example for for debugging, profiling (understanding performance bottlenecks), and audits.</p>
<div id="terminology" class="section level2">
<h2 class="hasAnchor">
<a href="#terminology" class="anchor"></a>Terminology</h2>
<ul>
<li>
<strong>Logger</strong>: An object that can receive <strong>events</strong>, and writes them to a log. A logger has a <strong>name</strong>, a prespecified <strong>event level</strong> (only events at or above that level are logged), and one or more <strong>appenders</strong>.</li>
<li>
<strong>Event</strong>: Consists of a message and an event level.</li>
<li>
<strong>Event level</strong>: Each event has an associated level. These levels (in ranked order) are
<ul>
<li>
<code>TRACE</code>: Events to mark the analysis has passed through some code.</li>
<li>
<code>DEBUG</code>: Events to help understand the state of the code (e.g. whether a variable has a value).</li>
<li>
<code>INFO</code>: Events typically displayed to the user to inform of the progress.</li>
<li>
<code>WARN</code>: Events that indicate something probably requires attention.</li>
<li>
<code>ERROR</code>: Events indicating something went wrong.</li>
<li>
<code>FATAL</code>: Events indicating something went wrong, causing the analysis to terminate.</li>
</ul>
</li>
<li>
<strong>Appender</strong>: An object that writes to a destination, for example the console or a file. An appender uses a <strong>layout</strong> to format its messages. There currently are three types of appenders:</li>
<li>
<strong>Console appender</strong>: Writes to the console, created using the <code>createConsoleAppender</code> function.</li>
<li>
<strong>File appender</strong>: Writes to a file, created using the <code>createFileAppender</code> function.</li>
<li>
<strong>E-mail appender</strong>: Sends an e-mail, created using the <code>createEmailAppender</code> function.</li>
<li>
<strong>Layout</strong>: Objects specifying the format in which the log will be created. The following layouts are available:
<ul>
<li>
<code>layoutSimple</code>: Only outputs the message.</li>
<li>
<code>layoutTimestamp</code>: Adds the current time and date to the message.</li>
<li>
<code>layoutStackTrace</code>: Adds the time and date, and full stack trace to the message.</li>
<li>
<code>layoutParallel</code>: Includes the thread identifier, name of the package and function raising the event, the current time and date, the message level, and the message itself.</li>
<li>
<code>layoutErrorReport</code>: Creates a report for an event, including the message, stack trace, and information about the run-time environment such as the type of operating system, and installed R packages.</li>
<li>
<code>layoutEmail</code>: This layout adds the thread ID and stack trace to the message.</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="creating-a-console-logger" class="section level1">
<h1 class="hasAnchor">
<a href="#creating-a-console-logger" class="anchor"></a>Creating a console logger</h1>
<p>The code below demonstrates how one would create a logger that writes all events at level <code>INFO</code> or greater to the console using a layout with time stamp:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">logger</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/createLogger.html">createLogger</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"SIMPLE"</span>,
                       <span class="kw">threshold</span> <span class="kw">=</span> <span class="st">"INFO"</span>,
                       <span class="kw">appenders</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/createConsoleAppender.html">createConsoleAppender</a></span>(<span class="kw">layout</span> <span class="kw">=</span> <span class="no">layoutTimestamp</span>)))

<span class="fu"><a href="../reference/registerLogger.html">registerLogger</a></span>(<span class="no">logger</span>)

<span class="fu"><a href="../reference/logTrace.html">logTrace</a></span>(<span class="st">"This event is below the threshold (INFO)"</span>)

<span class="fu"><a href="../reference/logInfo.html">logInfo</a></span>(<span class="st">"Hello world"</span>)</pre></body></html></div>
<pre><code>#&gt; Hello world
#&gt; 2020-06-03 06:50:47  Hello world</code></pre>
<p>Note that the message is displayed twice. This is because there is a default logger that uses the simple layout and threshold = “INFO”, and writes to console. We can remove this logger before registering our logger to avoid duplication:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../reference/clearLoggers.html">clearLoggers</a></span>()

<span class="no">logger</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/createLogger.html">createLogger</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"SIMPLE"</span>,
                       <span class="kw">threshold</span> <span class="kw">=</span> <span class="st">"INFO"</span>,
                       <span class="kw">appenders</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/createConsoleAppender.html">createConsoleAppender</a></span>(<span class="kw">layout</span> <span class="kw">=</span> <span class="no">layoutTimestamp</span>)))

<span class="fu"><a href="../reference/registerLogger.html">registerLogger</a></span>(<span class="no">logger</span>)

<span class="fu"><a href="../reference/logInfo.html">logInfo</a></span>(<span class="st">"Hello world"</span>)</pre></body></html></div>
<pre><code>#&gt; 2020-06-03 06:50:47  Hello world</code></pre>
<div id="shorthand" class="section level2">
<h2 class="hasAnchor">
<a href="#shorthand" class="anchor"></a>Shorthand</h2>
<p>A shorthand for creating a simple console logger is offered by the <code>addDefaultConsoleLogger</code> function. The code</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../reference/addDefaultConsoleLogger.html">addDefaultConsoleLogger</a></span>()</pre></body></html></div>
<p>is equivalent to</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="../reference/registerLogger.html">registerLogger</a></span>(<span class="fu"><a href="../reference/createLogger.html">createLogger</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"SIMPLE"</span>,
                            <span class="kw">threshold</span> <span class="kw">=</span> <span class="st">"INFO"</span>,
                            <span class="kw">appenders</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/createConsoleAppender.html">createConsoleAppender</a></span>(<span class="kw">layout</span> <span class="kw">=</span> <span class="no">layoutSimple</span>))))</pre></body></html></div>
</div>
</div>
<div id="creating-a-file-logger" class="section level1">
<h1 class="hasAnchor">
<a href="#creating-a-file-logger" class="anchor"></a>Creating a file logger</h1>
<p>Probably more useful is a file logger. In the code below, we instantiate a logger that writes to file, using a threshold of <code>TRACE</code> (so including all events), and using the layout for parallel processing.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">logFileName</span> <span class="kw">&lt;-</span> <span class="st">"log.txt"</span></pre></body></html></div>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">logger</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/createLogger.html">createLogger</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"PARALLEL"</span>,
                       <span class="kw">threshold</span> <span class="kw">=</span> <span class="st">"TRACE"</span>,
                       <span class="kw">appenders</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/createFileAppender.html">createFileAppender</a></span>(<span class="kw">layout</span> <span class="kw">=</span> <span class="no">layoutParallel</span>,
                                                           <span class="kw">fileName</span> <span class="kw">=</span> <span class="no">logFileName</span>)))
<span class="fu"><a href="../reference/registerLogger.html">registerLogger</a></span>(<span class="no">logger</span>)

<span class="fu"><a href="../reference/logTrace.html">logTrace</a></span>(<span class="st">"Executed this line"</span>)

<span class="fu"><a href="../reference/logDebug.html">logDebug</a></span>(<span class="st">"There are "</span>,  <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="../reference/getLoggers.html">getLoggers</a></span>()), <span class="st">" loggers"</span>)

<span class="fu"><a href="../reference/logInfo.html">logInfo</a></span>(<span class="st">"Hello world"</span>)</pre></body></html></div>
<pre><code>#&gt; 2020-06-03 06:50:47  Hello world</code></pre>
<p>We can read the log file:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/readChar.html">readChar</a></span>(<span class="no">logFileName</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.info.html">file.info</a></span>(<span class="no">logFileName</span>)$<span class="no">size</span>))</pre></body></html></div>
<pre><code>#&gt; 2020-06-03 06:50:47  [Main thread]   TRACE   evaluate    timing_fn   Executed this line
#&gt; 2020-06-03 06:50:47  [Main thread]   DEBUG   evaluate    timing_fn   There are 2 loggers
#&gt; 2020-06-03 06:50:47  [Main thread]   INFO    evaluate    timing_fn   Hello world</code></pre>
<p>And clean it up when we’re done:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span>(<span class="no">logFileName</span>)</pre></body></html></div>
<div id="shorthand-1" class="section level2">
<h2 class="hasAnchor">
<a href="#shorthand-1" class="anchor"></a>Shorthand</h2>
<p>A shorthand for creating the file logger detailed here is offered by the <code>addDefaultFileLogger</code> function. The code</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="../reference/addDefaultFileLogger.html">addDefaultFileLogger</a></span>(<span class="no">logFileName</span>)</pre></body></html></div>
<p>is equivalent to</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="../reference/registerLogger.html">registerLogger</a></span>(<span class="fu"><a href="../reference/createLogger.html">createLogger</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"DEFAULT_FILE_LOGGER"</span>,
                            <span class="kw">threshold</span> <span class="kw">=</span> <span class="st">"TRACE"</span>,
                            <span class="kw">appenders</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/createFileAppender.html">createFileAppender</a></span>(<span class="kw">layout</span> <span class="kw">=</span> <span class="no">layoutParallel</span>,
                                                                <span class="kw">fileName</span> <span class="kw">=</span> <span class="no">logFileName</span>))))</pre></body></html></div>
</div>
</div>
<div id="creating-an-error-report-logger" class="section level1">
<h1 class="hasAnchor">
<a href="#creating-an-error-report-logger" class="anchor"></a>Creating an error report logger</h1>
<p>A special case of a file logger is an error report logger. Rather than logging one event per row, the error report logger creates a single file dedicated to one event. As the name implies, this makes most sense for fatal error events. The error report contains the error message, stack trace, and information on the run-time environment, including the type of operating system and installed R packages. The idea is that this report can be shared between someone running the code and someone debugging the code remotely.</p>
<p>The error report will be overwritten if a new error occurs, unless the new error occurs within 60 seconds of the creation of the error report. The reason for this delay is that it may be that a sub-thread throws an error, which we’d want to catch, followed shortly after by an error in the main thread, which we’d also like to catch. Both threads will then provide their error messages and stack trace, but only the main thread will include the information about the run-time environment, to avoid redundancy.</p>
<div id="shorthand-2" class="section level2">
<h2 class="hasAnchor">
<a href="#shorthand-2" class="anchor"></a>Shorthand</h2>
<p>It is recommended to simply always use the shorthand for creating an error report logger:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="../reference/addDefaultErrorReportLogger.html">addDefaultErrorReportLogger</a></span>()</pre></body></html></div>
<p>which is equivalent to</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">fileName</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(), <span class="st">"errorReportR.txt"</span>)

<span class="fu"><a href="../reference/registerLogger.html">registerLogger</a></span>(<span class="fu"><a href="../reference/createLogger.html">createLogger</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"DEFAULT_ERRORREPORT_LOGGER"</span>,
                            <span class="kw">threshold</span> <span class="kw">=</span> <span class="st">"FATAL"</span>,
                            <span class="kw">appenders</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/createFileAppender.html">createFileAppender</a></span>(<span class="kw">layout</span> <span class="kw">=</span> <span class="no">layoutErrorReport</span>,
                                                                <span class="kw">fileName</span> <span class="kw">=</span> <span class="no">fileName</span>,
                                                                <span class="kw">overwrite</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                                                <span class="kw">expirationTime</span> <span class="kw">=</span> <span class="fl">60</span>))))</pre></body></html></div>
</div>
</div>
<div id="creating-an-e-mail-logger" class="section level1">
<h1 class="hasAnchor">
<a href="#creating-an-e-mail-logger" class="anchor"></a>Creating an e-mail logger</h1>
<p>We can also add a logger that sends an e-mail whenever an event is logged above the specified threshold. For example, for a process running on a remote machine it might be useful to receive e-mails of fatal events:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">mailSettings</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">from</span> <span class="kw">=</span> <span class="st">"someone@gmail.com"</span>,
<span class="kw">to</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"someone_else@gmail.com"</span>),
<span class="kw">smtp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">host.name</span> <span class="kw">=</span> <span class="st">"smtp.gmail.com"</span>,
<span class="kw">port</span> <span class="kw">=</span> <span class="fl">465</span>,
<span class="kw">user.name</span> <span class="kw">=</span> <span class="st">"someone@gmail.com"</span>,
<span class="kw">passwd</span> <span class="kw">=</span> <span class="st">"super_secret!"</span>,
<span class="kw">ssl</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
<span class="kw">authenticate</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
<span class="kw">send</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="no">logger</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/createLogger.html">createLogger</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"EMAIL"</span>,
<span class="kw">threshold</span> <span class="kw">=</span> <span class="st">"FATAL"</span>,
<span class="kw">appenders</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/createEmailAppender.html">createEmailAppender</a></span>(<span class="kw">layout</span> <span class="kw">=</span> <span class="no">layoutEmail</span>,
<span class="kw">mailSettings</span> <span class="kw">=</span> <span class="no">mailSettings</span>)))
<span class="fu"><a href="../reference/registerLogger.html">registerLogger</a></span>(<span class="no">logger</span>)

<span class="fu"><a href="../reference/logFatal.html">logFatal</a></span>(<span class="st">"No more data to process"</span>)</pre></body></html></div>
<p>Note that the <code>mailSettings</code> object will be passed on to the <code>send.mail</code> function in the <code>mailR</code> package, so for more details see <code><a href="https://rdrr.io/pkg/mailR/man/send.mail.html">?mailR::send.mail</a></code>’</p>
<div id="shorthand-3" class="section level2">
<h2 class="hasAnchor">
<a href="#shorthand-3" class="anchor"></a>Shorthand</h2>
<p>A shorthand for creating the e-mail logger detailed here is offered by the <code>addDefaultEmailLogger</code> function. The code</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="../reference/addDefaultEmailLogger.html">addDefaultEmailLogger</a></span>(<span class="no">mailSettings</span>)</pre></body></html></div>
<p>is equivalent to</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="../reference/registerLogger.html">registerLogger</a></span>(<span class="fu"><a href="../reference/createLogger.html">createLogger</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"DEFAULT_EMAIL_LOGGER"</span>,
<span class="kw">threshold</span> <span class="kw">=</span> <span class="st">"FATAL"</span>,
<span class="kw">appenders</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/createEmailAppender.html">createEmailAppender</a></span>(<span class="kw">layout</span> <span class="kw">=</span> <span class="no">layoutEmail</span>,
<span class="kw">mailSettings</span> <span class="kw">=</span> <span class="no">mailSettings</span>))))</pre></body></html></div>
</div>
</div>
<div id="warnings-and-fatal-errors" class="section level1">
<h1 class="hasAnchor">
<a href="#warnings-and-fatal-errors" class="anchor"></a>Warnings and fatal errors</h1>
<p>All R warnings and errors are automatically logged, and therefore do not require explicit logging. For example:</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="../reference/clearLoggers.html">clearLoggers</a></span>()
<span class="fu"><a href="../reference/addDefaultFileLogger.html">addDefaultFileLogger</a></span>(<span class="no">logFileName</span>)

<span class="fu"><a href="https://rdrr.io/r/base/warning.html">warning</a></span>(<span class="st">"Danger!"</span>)

<span class="co"># This throws a warning:</span>
<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="st">'a'</span>)

<span class="co"># This throws an error:</span>
<span class="no">a</span> <span class="kw">&lt;-</span> <span class="no">b</span>

<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/readChar.html">readChar</a></span>(<span class="no">logFileName</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.info.html">file.info</a></span>(<span class="no">logFileName</span>)$<span class="no">size</span>))</pre></body></html></div>
<pre><code>#&gt; 2020-06-03 06:50:47  [Main thread]   WARN    evaluate    timing_fn   Danger!
#&gt; 2020-06-03 06:50:47  [Main thread]   WARN    evaluate    timing_fn   Warning: NAs introduced by coercion
#&gt; 2020-06-03 06:50:47  [Main thread]   FATAL   evaluate    timing_fn   Error: object a not found</code></pre>
</div>
<div id="logging-when-parallel-processing" class="section level1">
<h1 class="hasAnchor">
<a href="#logging-when-parallel-processing" class="anchor"></a>Logging when parallel processing</h1>
<p>The logging functions are designed to work with the parallel processing functions included in this package. The <code>layoutParallel</code> records thread identifiers, making it possible to later untangle the various threads. Below is a simple example:</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span>(<span class="no">logFileName</span>) <span class="co"># Clean up log file from the previous example</span>
<span class="fu"><a href="../reference/clearLoggers.html">clearLoggers</a></span>() <span class="co"># Clean up the loggers from the previous example</span>

<span class="fu"><a href="../reference/addDefaultFileLogger.html">addDefaultFileLogger</a></span>(<span class="no">logFileName</span>)

<span class="no">cluster</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/makeCluster.html">makeCluster</a></span>(<span class="fl">3</span>)

<span class="no">fun</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
<span class="kw pkg">ParallelLogger</span><span class="kw ns">::</span><span class="fu"><a href="../reference/logInfo.html">logInfo</a></span>(<span class="st">"The value of x is "</span>, <span class="no">x</span>)
<span class="co"># Do something</span>
<span class="kw">if</span> (<span class="no">x</span> <span class="kw">==</span> <span class="fl">6</span>)
<span class="kw pkg">ParallelLogger</span><span class="kw ns">::</span><span class="fu"><a href="../reference/logDebug.html">logDebug</a></span>(<span class="st">"X equals 6"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw">NULL</span>)
}

<span class="no">dummy</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/clusterApply.html">clusterApply</a></span>(<span class="no">cluster</span>, <span class="fl">1</span>:<span class="fl">10</span>, <span class="no">fun</span>, <span class="kw">progressBar</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="fu"><a href="../reference/stopCluster.html">stopCluster</a></span>(<span class="no">cluster</span>)

<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/readChar.html">readChar</a></span>(<span class="no">logFileName</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.info.html">file.info</a></span>(<span class="no">logFileName</span>)$<span class="no">size</span>))</pre></body></html></div>
<pre><code>#&gt; 2020-06-03 06:50:48  [Main thread]   TRACE   evaluate    timing_fn   Initiating cluster with 3 threads
#&gt; 2020-06-03 06:50:49  [Thread 1]  TRACE           Thread 1 initiated
#&gt; 2020-06-03 06:50:49  [Thread 2]  TRACE           Thread 2 initiated
#&gt; 2020-06-03 06:50:49  [Thread 3]  TRACE           Thread 3 initiated
#&gt; 2020-06-03 06:50:49  [Thread 1]  INFO            The value of x is 1
#&gt; 2020-06-03 06:50:49  [Thread 3]  INFO            The value of x is 3
#&gt; 2020-06-03 06:50:49  [Thread 2]  INFO            The value of x is 2
#&gt; 2020-06-03 06:50:49  [Thread 1]  INFO            The value of x is 4
#&gt; 2020-06-03 06:50:49  [Thread 2]  INFO            The value of x is 5
#&gt; 2020-06-03 06:50:49  [Thread 3]  INFO            The value of x is 6
#&gt; 2020-06-03 06:50:49  [Thread 1]  INFO            The value of x is 7
#&gt; 2020-06-03 06:50:49  [Thread 3]  DEBUG           X equals 6
#&gt; 2020-06-03 06:50:49  [Thread 2]  INFO            The value of x is 8
#&gt; 2020-06-03 06:50:49  [Thread 1]  INFO            The value of x is 9
#&gt; 2020-06-03 06:50:49  [Thread 3]  INFO            The value of x is 10
#&gt; 2020-06-03 06:50:49  [Main thread]   TRACE   evaluate    timing_fn   Stopping cluster
#&gt; 2020-06-03 06:50:49  [Thread 3]  TRACE           Thread 3 terminated
#&gt; 2020-06-03 06:50:49  [Thread 1]  TRACE           Thread 1 terminated
#&gt; 2020-06-03 06:50:49  [Thread 2]  TRACE           Thread 2 terminated</code></pre>
</div>
<div id="creating-loggers-in-functions" class="section level1">
<h1 class="hasAnchor">
<a href="#creating-loggers-in-functions" class="anchor"></a>Creating loggers in functions</h1>
<p>Creating a logger right before starting a very complex computation is probably a good idea, to capture information that may help to debug when things go wrong. Although having multiple loggers simultaneously should work fine, it probably makes sense to only invoke loggers at the highest level. So instead of</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">subSubTask</span> <span class="kw">&lt;-</span> <span class="kw">function</span>() {
  <span class="fu"><a href="../reference/addDefaultFileLogger.html">addDefaultFileLogger</a></span>(<span class="st">"subSubTaskLog.txt"</span>)
  <span class="co"># do something</span>
}

<span class="no">subTask</span> <span class="kw">&lt;-</span> <span class="kw">function</span>() {
  <span class="fu"><a href="../reference/addDefaultFileLogger.html">addDefaultFileLogger</a></span>(<span class="st">"subTaskLog.txt"</span>)
  <span class="co"># do something</span>
  <span class="fu">subSubTask</span>()
}

<span class="no">mainTask</span> <span class="kw">&lt;-</span> <span class="kw">function</span>() {
  <span class="fu"><a href="../reference/addDefaultFileLogger.html">addDefaultFileLogger</a></span>(<span class="st">"mainTaskLog.txt"</span>)
  <span class="co"># do something</span>
  <span class="fu">subTask</span>()
}</pre></body></html></div>
<p>it would be better to have only one logger:</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">subSubTask</span> <span class="kw">&lt;-</span> <span class="kw">function</span>() {
  <span class="co"># do something</span>
}

<span class="no">subTask</span> <span class="kw">&lt;-</span> <span class="kw">function</span>() {
  <span class="co"># do something</span>
  <span class="fu">subSubTask</span>()
}

<span class="no">mainTask</span> <span class="kw">&lt;-</span> <span class="kw">function</span>() {
  <span class="fu"><a href="../reference/addDefaultFileLogger.html">addDefaultFileLogger</a></span>(<span class="st">"log.txt"</span>)
  <span class="co"># do something</span>
  <span class="fu">subTask</span>()
}</pre></body></html></div>
<p>Also, as a courtesy to the user, please clean up the logger after the function is finished. By using <code>on.exit</code>, we can ensure the logger is always closed, even when the function stops unexpectedly (e.g. due to an error):</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="no">mainTask</span> <span class="kw">&lt;-</span> <span class="kw">function</span>() {
  <span class="fu"><a href="../reference/addDefaultFileLogger.html">addDefaultFileLogger</a></span>(<span class="st">"log.txt"</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html">on.exit</a></span>(<span class="fu"><a href="../reference/unregisterLogger.html">unregisterLogger</a></span>(<span class="st">"DEFAULT_FILE_LOGGER"</span>))
  <span class="co"># do something</span>
}</pre></body></html></div>
</div>
<div id="shiny-log-viewer" class="section level1">
<h1 class="hasAnchor">
<a href="#shiny-log-viewer" class="anchor"></a>Shiny log viewer</h1>
<p>A Shiny app for viewing a log file created using the <code>layoutParallel</code> is included in the package. To explore the log created in the prior example, run</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="fu"><a href="../reference/launchLogViewer.html">launchLogViewer</a></span>(<span class="no">logFileName</span>)</pre></body></html></div>
<p>to launch the viewer shown in Figure 1.</p>
<div class="figure">
<img src="shinyApp.png" alt=""><p class="caption">Shiny log viewer app</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Martijn Schuemie, Marc Suchard.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
